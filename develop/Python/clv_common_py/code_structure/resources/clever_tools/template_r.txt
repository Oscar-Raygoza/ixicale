# -*- coding: utf-8 -*-
"""
    resources.{file_name}.{file_name}
    ~~~~~~~~~~~~~~

    Autogenerated resource to '{class_name}' model

    :copyright: (c) 2019 by Software Clever, Palace Resorts CEDIS.
    :author: lresendiz
    :author: ixicale
    :license: Private.
"""
from flask_restful import Resource, reqparse
from config import base, db
from schemas.{file_name} import {class_name}Model, {class_name}Schema
from flask import request
from marshmallow import ValidationError


class {class_name}(Resource):
    def get(self, id=None):
        {file_name} = {class_name}Model.query.get(id)
        if {file_name}:
            {file_name} = (
                {class_name}Schema.select.dump({file_name})
            )
        return base.build_success_response(200, {file_name})

    def put(self, id=None):
        data = request.get_json(force=True)
        data["{pk_field}"] = id
        try:
            {file_name} = {class_name}Schema.update.load(
                data,
                instance={class_name}Model.query.get(id),
                # partial=True
            )
            db.session.commit()
            return base.build_success_response(204)
        except ValidationError as err:
            return base.build_error_response(400, err.messages)
        except Exception as e:
            return base.build_error_response(500, message=str(e))


class {class_name}s(Resource):
    def get(self):
        {file_name} = {class_name}Model.query.all()
        if {file_name}:
            {file_name} = (
                {class_name}Schema.select_many.dump({file_name})
            )
        return base.build_success_response(200, {file_name})

    def post(self):
        data = request.get_json(force=True)
        try:
            {file_name} = {class_name}Schema.create.load(data)
            db.session.add({file_name})
            db.session.commit()
            return base.build_success_response(201)
        except ValidationError as err:
            return base.build_error_response(400, err.messages)
        except Exception as e:
            return base.build_error_response(500, message=str(e))


class {class_name}sFilters(Resource):
    #: example filter
    def get(self):
        parser = reqparse.RequestParser()
        parser.add_argument(
            "usuario_creacion",
            location="args",
            store_missing=False
        )
        parser.add_argument(
            "estado",
            location="args",
            store_missing=False,
            choices=[0, 1],
            type=int,
        )
        args = parser.parse_args()

        {file_name} = {class_name}Model.query.filter_by(**args).all()
        if {file_name}:
            {file_name} = (
                {class_name}Schema.select_many.dump({file_name})
            )
        return base.build_success_response(200, {file_name})
